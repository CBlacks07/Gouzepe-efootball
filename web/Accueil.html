<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>GOUZEPE eFOOTBALL ‚Äî Accueil</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="theme.css">
  <link rel="stylesheet" href="common.css">
  <style>
    :root{
      --bg:#0b1119;--panel:#0f1722;--card:#111b28;--text:#e5e7eb;--muted:#94a3b8;--border:#1f2937;
      --brand:#16a34a;--accent:#3b82f6;--radius:14px;--shadow:0 6px 18px rgba(0,0,0,.28);--pad:clamp(12px,2.5vw,24px)
    }
    html,body{height:100%}
    body{
      margin:0;color:var(--text);
      background:
        radial-gradient(800px 500px at 10% -10%,rgba(59,130,246,.10),transparent 55%),
        radial-gradient(900px 600px at 100% 20%,rgba(22,163,74,.10),transparent 60%),
        var(--bg);
      font:400 16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;letter-spacing:.2px
    }
    html.light body{
      background:linear-gradient(180deg,#fff,#f4f7fb);color:#0f172a
    }
    #bgSlider{
      position:fixed; inset:0; z-index:0; pointer-events:none; opacity:.20; transition:opacity .5s ease;
      background-position:center; background-size:cover; background-repeat:no-repeat;
      filter:saturate(.9) contrast(.98) brightness(.95);
    }
    html.light #bgSlider{opacity:.15; filter:saturate(.85) contrast(.95) brightness(1)}
    .overlayGrad{
      position:fixed; inset:0; z-index:1; pointer-events:none;
      background: radial-gradient(60% 40% at 10% 0%, rgba(59,130,246,.14), transparent 60%),
                  radial-gradient(60% 45% at 90% 100%, rgba(34,197,94,.14), transparent 60%);
    }
    .top{
      position:sticky;top:0;z-index:40;display:flex;align-items:center;gap:12px;
      padding:10px var(--pad);background:rgba(10,14,22,.65);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)
    }
    html.light .top{background:rgba(255,255,255,.75)}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:inherit;user-select:none}
    .logo{width:42px;height:42px;border-radius:12px;object-fit:cover;border:1px solid var(--border);background:#0d1420}
    .brand-title{display:flex;flex-direction:column;line-height:1.1}
    .brand-title h1{margin:0;font-size:18px;letter-spacing:.3px;font-weight:800}
    .season-sub{margin:0;color:var(--muted);font-size:12px}
    #menuToggle{display:none;flex:0 0 auto;appearance:none;border:1px solid var(--border);background:transparent;color:inherit;border-radius:10px;padding:8px 10px;align-items:center;gap:8px}
    .nav{display:flex;align-items:center;gap:8px;overflow-x:auto;padding:4px 0;scrollbar-width:thin;-webkit-overflow-scrolling:touch}
    #menu{display:flex;gap:8px}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:8px 12px;border-radius:999px;font-weight:600;border:1px solid var(--border);background:transparent;color:inherit;text-decoration:none;line-height:1;white-space:nowrap;transition:filter .15s,transform .02s}
    .btn:hover{filter:brightness(1.1)} .btn:active{transform:translateY(1px)}
    .btn.primary{background:rgba(22,163,74,.15);border-color:#1e3a2f}
    .btn.info{background:rgba(59,130,246,.14);border-color:#1e3a8a}
    .btn.warn{background:rgba(245,158,11,.14);border-color:#7c2d12}
    .btn.ghost{background:transparent}
    .spacer{flex:1 1 auto} .tiny{font-size:12px;opacity:.8}
    .badge{display:inline-flex;align-items:center;gap:8px;padding:4px 8px;border:1px dashed var(--border);border-radius:999px;font-weight:600;opacity:.9}
    .badge .dot{width:8px;height:8px;border-radius:50%;background:var(--brand)}
    .badge-top{display:none}
    @media (max-width: 900px){
      #menuToggle{display:inline-flex}
      .nav{display:none}
      .top.nav-open .nav{display:flex}
    }
    main{display:block; position:relative; z-index:2}
    section{padding:clamp(14px,2.8vw,28px) var(--pad);border-top:1px solid rgba(255,255,255,.04)}
    .hero{padding-block:clamp(18px,4vw,36px);background:linear-gradient(180deg,rgba(15,23,34,0),rgba(15,23,34,.35))}
    html.light .hero{background:linear-gradient(180deg,rgba(255,255,255,0),rgba(0,0,0,.03))}
    .heading{font-size:clamp(24px,3.4vw,40px);letter-spacing:.4px;margin:0 0 6px}
    .sub{color:var(--muted);max-width:75ch;margin:0}
    .actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:14px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:clamp(12px,2vw,18px);margin-block:10px}
    html.light .card{background:#fff;border-color:#e5e7eb;box-shadow:0 6px 20px rgba(2,6,23,.06)}
    .list{display:flex;flex-direction:column;gap:10px;margin:0;padding:0;list-style:none}
    .item{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:transparent}
    .item strong{letter-spacing:.3px}.meta{color:var(--muted);font-size:14px}
    /* Mobile sheet menu */
    #mobileMenu{position:fixed; inset:0; z-index:60; display:flex; align-items:flex-start; justify-content:center;
      padding:18px; background:rgba(0,0,0,.55); backdrop-filter:blur(2px);}
    #mobileMenu[hidden]{ display:none }
    .mm-panel{width:min(92vw,420px); margin-top:68px; background:var(--panel); color:var(--text);
      border:1px solid var(--border); border-radius:16px; box-shadow:var(--shadow); padding:16px 14px;}
    .mm-title{font-weight:800;text-align:center;margin:4px 0 12px}
    .mm-list{display:grid;gap:12px}
    .mm-btn{display:flex;align-items:center;justify-content:center;gap:10px;padding:12px 14px;border-radius:14px;border:1px solid var(--border);
      background:rgba(255,255,255,.02);color:inherit;text-decoration:none;font-weight:700;}
    .mm-theme{display:flex;justify-content:center;margin:8px 0}
    .mm-logout{display:flex;justify-content:center}
    .mm-logout .btn{background:rgba(239,68,68,.1);border-color:#7f1d1d;color:#f87171}
    @media (min-width:901px){ #mobileMenu{ display:none !important } }
  </style>
  <script defer src="common.js"></script>
</head>
<body>
  <div id="bgSlider" aria-hidden="true"></div>
  <div class="overlayGrad" aria-hidden="true"></div>

  <header class="top" id="topbar">
    <a class="brand" href="./Accueil.html" aria-label="Accueil GOUZEPE">
      <img id="clubLogo" class="logo" src="assets/fond.png" alt="Logo">
      <div class="brand-title">
        <h1>GOUZEPE eFOOTBALL</h1>
        <div class="season-sub"><span id="season-text" style="color: #16a34a; font-weight: bold;">Saison</span></div>
      </div>
    </a>

    <button id="menuToggle" class="btn ghost" aria-controls="menu" aria-expanded="false">‚ò∞ Menu</button>
    <nav class="nav" aria-label="Navigation principale">
      <div id="menu">
        <a class="btn ghost" href="./Duel.html">üí™üèΩ Duel</a>
        <a class="btn ghost" href="./Classement-general.html">üìä Classements</a>
        <a class="btn ghost" href="./Panel-Membre.html">üë§ Mon espace</a>
        <a class="btn ghost adminNav" href="./Admin-Joueurs.html" style="display:none">üë• Admin-Joueurs</a>
        <a class="btn ghost adminNav" href="./Admin-Utilisateurs.html" style="display:none">üõ°Ô∏è Admin Utilisateurs</a>
        <button id="logoutBtn" class="btn ghost danger" type="button">D√©connexion</button>
      </div>
    </nav>

    <div class="spacer"></div>
    <div id="season-badge" class="badge badge-top"><span class="dot"></span><span id="season-top">Saison</span></div>
    <button id="themeBtn" class="btn ghost" title="Th√®me clair/sombre">‚òÄÔ∏è/üåô</button>

    <!-- Mobile sheet -->
    <div id="mobileMenu" hidden>
      <div class="mm-panel" role="dialog" aria-modal="true" aria-labelledby="mmTitle">
        <div id="mmTitle" class="mm-title">Menu</div>
        <div class="mm-list">
          <a class="mm-btn" href="./Classement-general.html">üìä Classements</a>
          <a class="mm-btn" href="./Panel-Membre.html">üë§ Mon espace</a>
          <a class="mm-btn adminOnly" id="mmAdminPlayers" href="./Admin-Joueurs.html" style="display:none">üë• Admin-Joueurs</a>
        </div>
        <div class="mm-theme"><button id="mmTheme" class="btn">‚òÄÔ∏è / üåô</button></div>
        <div class="mm-logout"><button id="mmLogout" class="btn">D√©connexion</button></div>
      </div>
    </div>
  </header>

  <main>
    <section class="hero">
      <h2 class="heading">Bienvenue au club üëã</h2>
      <p class="sub">
        Ici, on vit <b>eFootball</b> √† fond : saisons intenses, duels, classements en temps r√©el et gestion stricte des r√¥les.
        Tape tes scores, compare, imprime tes feuilles de journ√©e et fais briller ton blason.
      </p>
      <div class="actions">
        <a class="btn primary" href="./Duel.html">Lancer un duel</a>
        <a class="btn info" href="./Classement-general.html">Voir le classement</a>
        <a class="btn ghost" href="./Panel-Membre.html">Mon espace membre</a>
      </div>
    </section>

    <section><div class="card">
      <strong style="font-size:18px">√Ä la une</strong>
      <ul class="list" id="news"><li class="item"><div><strong>Chargement‚Ä¶</strong><div class="meta">Connexion au serveur</div></div></li></ul>
    </div></section>

    <section><div class="card">
      <strong style="font-size:18px">Activit√© r√©cente</strong>
      <ul class="list" id="recent"><li class="item"><div><strong>‚Äî</strong><div class="meta">Aucun duel r√©cent</div></div></li></ul>
    </div></section>
  </main>

  <footer style="text-align:center;padding:20px;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif">
    Copyright ¬© GOUZEPE GAMING CLUB 2025
  </footer>

  <script>
  /* Helpers API */
  const isPrivate=(h)=>/^(localhost|127\.0\.0\.1|10\.\d+\.\d+\.\d+|192\.168\.\d+\.\d+|172\.(1[6-9]|2\d|3[01])\.\d+\.\d+)$/.test(h||'');
  function DEF_API(){
    const host=location.hostname||''; 
    if(isPrivate(host)) return (location.protocol.startsWith('http')?location.protocol:'http:')+'//'+host+':3000';
    if(host.endsWith('.onrender.com')){
      if(host.includes('-app.')) return 'https://'+host.replace('-app.','-api.');
      if(host.includes('app.'))  return 'https://'+host.replace('app.','api.');
    }
    return 'https://gouzepe-api.onrender.com';
  }
  const API = (localStorage.getItem('efoot.api')||DEF_API()).replace(/\/+$/,'');
  const TOKEN = localStorage.getItem('efoot.token')||'';
  const ROLE  = (localStorage.getItem('efoot.role')||'member').toLowerCase();
  function hd(){ return { headers: Object.assign({ 'Content-Type':'application/json' }, TOKEN? { Authorization: 'Bearer '+TOKEN } : {}) }; }
  async function waitHealth(maxMs=45000){
    const start=Date.now(); let tries=0;
    while(Date.now()-start<maxMs){
      tries++;
      try{ const r=await fetch(API+'/health',{cache:'no-store'}); if(r.ok) return true; }catch(_){}
      await new Promise(res=>setTimeout(res, Math.min(2500, 300*tries)));
    }
    return false;
  }

  /* UI */
  (function theme(){
    const btn=document.getElementById('themeBtn'); const apply=m=>{document.documentElement.classList.toggle('light',m==='light');localStorage.setItem('efoot.theme',m);btn.textContent=(m==='light')?'üåô':'‚òÄÔ∏è'};
    apply(localStorage.getItem('efoot.theme')||'dark'); btn.addEventListener('click',()=>apply(document.documentElement.classList.contains('light')?'dark':'light'));
    document.getElementById('mmTheme').onclick=()=>btn.click();
  })();
  (function mobileMenu(){
    const sheet=document.getElementById('mobileMenu'); const toggle=document.getElementById('menuToggle');
    const open=()=>{sheet.hidden=false;document.body.style.overflow='hidden';}; const close=()=>{sheet.hidden=true;document.body.style.overflow='';};
    toggle?.addEventListener('click',e=>{e.preventDefault();open();});
    sheet.addEventListener('click',e=>{ if(e.target===sheet) close(); });
    document.addEventListener('keydown',e=>{ if(e.key==='Escape' && !sheet.hidden) close(); });
    document.getElementById('mmAdminPlayers').style.display = ROLE==='admin' ? '' : 'none';
    document.getElementById('mmLogout').onclick=()=>document.getElementById('logoutBtn').click();
  })();
  document.getElementById('logoutBtn').onclick=async ()=>{
    try{ await fetch(API+'/auth/logout',{method:'POST', headers:{Authorization:'Bearer '+TOKEN}});}catch(_){}
    const keep=new Set(['efoot.theme','efoot.api']); for(let i=localStorage.length-1;i>=0;i--){ const k=localStorage.key(i); if(!keep.has(k)) localStorage.removeItem(k); }
    sessionStorage.clear(); location.href='login.html';
  };

  /* Data: √Ä la une = Top classement ; Activit√© = duels r√©cents */
  async function loadTop(){
    const box=document.getElementById('news'); box.innerHTML='';
    try{
      const r=await fetch(API+'/leaderboard',hd()); const d=await r.json();
      const top=(d.leaderboard||[]).slice(0,5);
      if(!top.length){ box.innerHTML='<li class="item"><div><strong>Pas encore de classement</strong><div class="meta">Enregistre des duels pour remplir le tableau</div></div></li>'; return; }
      const li=document.createElement('li'); li.className='item';
      li.innerHTML = '<div><strong>Top joueurs</strong><div class="meta">'+ top.map((x,i)=> `${i+1}. ${x.name||x.player_id} (${x.points} pts)` ).join(' ‚Ä¢ ') +'</div></div><a class="btn ghost" href="./Classement-general.html">D√©tails</a>';
      box.appendChild(li);
    }catch(e){
      box.innerHTML='<li class="item"><div><strong>Serveur indisponible</strong><div class="meta">R√©essaie plus tard</div></div></li>';
    }
  }
  async function loadRecent(){
    const box=document.getElementById('recent'); box.innerHTML='';
    try{
      const r=await fetch(API+'/duels/recent?limit=10',hd()); const d=await r.json();
      const arr=d.duels||[];
      if(!arr.length){ box.innerHTML='<li class="item"><div><strong>Aucun duel r√©cent</strong><div class="meta">Commence par cr√©er un duel</div></div><a class="btn" href="./Duel.html">Nouveau duel</a></li>'; return; }
      arr.forEach(x=>{
        const li=document.createElement('li'); li.className='item';
        const date = x.played_at ? new Date(x.played_at).toLocaleString('fr-FR') : '‚Äî';
        li.innerHTML = `<div><strong>${x.p1_name||x.p1_id} vs ${x.p2_name||x.p2_id}</strong><div class="meta">${date}</div></div><div class="meta">${x.score_a} ‚Äì ${x.score_b}</div>`;
        box.appendChild(li);
      });
    }catch(e){
      box.innerHTML='<li class="item"><div><strong>Impossible de charger</strong><div class="meta">V√©rifie la connexion</div></div></li>';
    }
  }

  /* Fonds diaporama (conserve ta logique) */
  (function bgSlider(){
    const candidates = [
      'fonds/image1.jpg','fonds/image2.jpg','fonds/image3.jpg','fonds/image4.jpg',
      'fonds/image5.jpg','fonds/image6.jpg','fonds/image7.jpg','fonds/image8.jpg',
      'fonds/image9.jpg','fonds/image10.jpg','fonds/image11.jpg','fonds/image12.jpg',
    ];
    const ok=[]; let idx=0, timer=null; const host=document.getElementById('bgSlider');
    const preload = (src)=> new Promise(res=>{ const im=new Image(); im.onload=()=>res(src); im.onerror=()=>res(null); im.src=src+'?v='+(Date.now()%1e6); });
    (async ()=>{
      for(const p of candidates){ const r=await preload(p); if(r) ok.push(r); }
      if(!ok.length){ host.style.display='none'; return; }
      const show=(i)=>{ host.style.backgroundImage = `url('${ok[i]}')`; };
      show(0);
      timer=setInterval(()=>{ idx=(idx+1)%ok.length; show(idx); }, 7000);
      document.addEventListener('visibilitychange',()=>{ if(document.hidden){ clearInterval(timer); } });
    })();
  })();

  (async function boot(){
    const ok = await waitHealth(45000);
    if(!ok) console.warn('API health timeout');
    await loadTop();
    await loadRecent();
  })();
  </script>
</body>
</html>
