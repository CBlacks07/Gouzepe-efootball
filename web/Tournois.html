<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<title>GOUZEPE eFOOTBALL ‚Äî Tournois</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="theme.css">
<link rel="stylesheet" href="mobile.css">
<script src="common.js"></script>

<style>
  :root{
    --bg:#0b1220;--panel:#0f1627;--card:#0c1426;--text:#e5e7eb;--muted:#94a3b8;--border:#1f2937;
    --accent:#2563eb; --champ:#ef4444; --ok:#16a34a; --ko:#ef4444; --mid:#64748b;
  }
  :root.light{--bg:#f4f6fb;--panel:#ffffff;--card:#ffffff;--text:#0f172a;--muted:#475569;--border:#e5e7eb;--accent:#1d4ed8}
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0;color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Trebuchet MS",sans-serif;
    background:
      radial-gradient(900px 600px at 20% 0%, rgba(96,165,250,.12), transparent 40%),
      radial-gradient(900px 600px at 80% 100%, rgba(34,197,94,.10), transparent 40%),
      linear-gradient(180deg, rgba(7,10,22,.94), rgba(15,23,42,.96)),
      url('assets/icons/apple-touch-icon.png') center/cover fixed no-repeat;
  }
  html.light body{
    background:
      radial-gradient(900px 600px at 20% 0%, rgba(96,165,250,.18), transparent 42%),
      radial-gradient(900px 600px at 80% 100%, rgba(34,197,94,.16), transparent 42%),
      linear-gradient(180deg, rgba(255,255,255,.86), rgba(245,247,251,.92)),
      url('assets/icons/apple-touch-icon.png') center/cover fixed no-repeat;
  }
  .wrap{max-width:1200px;margin:auto;padding:12px}

  .top{position:sticky;top:0;z-index:50;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:8px 6px;background:rgba(12,18,32,.55);backdrop-filter:blur(6px);border-radius:14px;margin-bottom:16px}
  html.light .top{background:rgba(255,255,255,.7)}

  .btn{border:1px solid var(--border);border-radius:12px;padding:10px 14px;background:#10192c;color:var(--text);cursor:pointer;font-size:14px;font-weight:600;transition:all 0.2s}
  html.light .btn{background:#fff}
  .btn:hover{background:var(--accent);border-color:var(--accent);color:#fff}
  .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
  .btn.danger{background:#7f1d1d;border-color:#7f1d1d;color:#fecaca}
  .btn.success{background:#14532d;border-color:#14532d;color:#d1fae5}

  input,select,textarea{border:1px solid var(--border);border-radius:12px;padding:10px 12px;background:#0b1020;color:var(--text);font-size:14px;width:100%}
  html.light input,html.light select,html.light textarea{background:#fff}

  .card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px}
  .card h3{margin:0 0 12px;font-size:18px;font-weight:800}

  .tournament-grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(320px, 1fr));gap:16px;margin-top:16px}
  .tournament-card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px;cursor:pointer;transition:all 0.2s}
  .tournament-card:hover{border-color:var(--accent);transform:translateY(-2px);box-shadow:0 4px 12px rgba(37,99,235,.2)}
  .tournament-card h4{margin:0 0 8px;font-size:16px;font-weight:700}
  .tournament-card .meta{font-size:12px;color:var(--muted);margin-bottom:8px}
  .tournament-card .status{display:inline-block;padding:4px 10px;border-radius:999px;font-size:11px;font-weight:700;text-transform:uppercase}
  .status.draft{background:rgba(100,116,139,.2);color:var(--muted)}
  .status.active{background:rgba(34,197,94,.2);color:var(--ok)}
  .status.closed{background:rgba(239,68,68,.2);color:var(--ko)}

  .participant-list{display:flex;flex-direction:column;gap:8px;margin-top:12px}
  .participant-item{display:flex;align-items:center;justify-content:space-between;padding:10px;background:var(--card);border:1px solid var(--border);border-radius:8px}

  .match-list{display:flex;flex-direction:column;gap:12px;margin-top:16px}
  .match-item{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px}
  .match-header{font-size:12px;color:var(--muted);margin-bottom:8px;font-weight:700}
  .match-players{display:flex;align-items:center;justify-content:space-between;gap:16px}
  .match-player{flex:1;text-align:center;font-weight:700;padding:12px;background:var(--panel);border-radius:8px}
  .match-vs{font-weight:900;color:var(--accent)}
  .match-scores{display:grid;grid-template-columns:1fr auto 1fr;gap:8px;align-items:center;margin-top:12px}
  .match-scores input{width:60px;text-align:center}

  .modal{position:fixed;inset:0;z-index:100;background:rgba(0,0,0,.75);display:none;align-items:center;justify-content:center;padding:20px}
  .modal.active{display:flex}
  .modal-content{background:var(--panel);border-radius:16px;max-width:800px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.5)}
  .modal-header{padding:20px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
  .modal-header h3{margin:0;font-size:20px;font-weight:800}
  .modal-body{padding:20px}
  .modal-footer{padding:20px;border-top:1px solid var(--border);display:flex;gap:12px;justify-content:flex-end}

  .form-group{margin-bottom:16px}
  .form-group label{display:block;margin-bottom:6px;font-weight:600;font-size:14px;color:var(--muted)}

  .tabs{display:flex;gap:8px;margin-bottom:20px;border-bottom:2px solid var(--border)}
  .tab{padding:12px 20px;cursor:pointer;font-weight:700;border-bottom:2px solid transparent;margin-bottom:-2px;transition:all 0.2s}
  .tab.active{border-bottom-color:var(--accent);color:var(--accent)}
  .tab:hover{color:var(--accent)}

  .winner-banner{background:linear-gradient(135deg, rgba(34,197,94,.2), rgba(16,185,129,.2));border:2px solid var(--ok);border-radius:14px;padding:24px;text-align:center;margin-top:20px}
  .winner-banner .trophy{font-size:48px;margin-bottom:12px}
  .winner-banner .name{font-size:32px;font-weight:900;color:var(--ok);margin-bottom:8px}
  .winner-banner .subtitle{font-size:16px;color:var(--muted)}

  @media (max-width: 760px){
    .tournament-grid{grid-template-columns:1fr}
    .match-players{flex-direction:column}
  }
</style>
</head>
<body class="container">
<div class="wrap">

  <!-- TOP BAR -->
  <header class="top">
    <a class="brand" href="./Accueil.html" style="text-decoration:none;color:inherit;display:flex;align-items:center;gap:12px">
      <img src="assets/icons/apple-touch-icon.png" alt="Logo" style="width:42px;height:42px;border-radius:12px">
      <div>
        <div style="font-weight:900;font-size:18px">GOUZEPE eFOOTBALL</div>
        <div style="font-size:12px;color:var(--muted)">Tournois</div>
      </div>
    </a>

    <div style="display:flex;gap:10px;align-items:center">
      <button id="theme" class="btn" title="Th√®me">‚òÄÔ∏è</button>
      <button id="logoutBtn" class="btn danger">D√©connexion</button>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main>
    <!-- Onglets -->
    <div class="tabs">
      <div class="tab active" data-tab="list">üìã Tous les tournois</div>
      <div class="tab adminOnly" data-tab="create" style="display:none">‚ûï Cr√©er un tournoi</div>
    </div>

    <!-- TAB: Liste des tournois -->
    <div class="tab-content" data-content="list">
      <div class="card">
        <h3>Tournois</h3>
        <div id="tournamentList" class="tournament-grid">
          <p style="color:var(--muted)">Chargement...</p>
        </div>
      </div>
    </div>

    <!-- TAB: Cr√©er un tournoi (admin) -->
    <div class="tab-content adminOnly" data-content="create" style="display:none">
      <div class="card">
        <h3>Cr√©er un nouveau tournoi</h3>
        <form id="createTournamentForm">
          <div class="form-group">
            <label>Nom du tournoi *</label>
            <input type="text" id="tournamentName" required placeholder="Ex: Coupe d'Automne 2025">
          </div>

          <div class="form-group">
            <label>Type de jeu *</label>
            <input type="text" id="gameType" required placeholder="Ex: eFootball, Tekken 8, Street Fighter 6...">
          </div>

          <div class="form-group">
            <label>Format du tournoi *</label>
            <select id="tournamentFormat" required>
              <option value="">-- Choisir --</option>
              <option value="single_elimination">üèÜ Simple √©limination</option>
              <option value="double_elimination">üèÖ Double √©limination</option>
              <option value="round_robin">üîÑ Round-Robin (tous contre tous)</option>
            </select>
          </div>

          <div class="form-group">
            <label>Format des matchs *</label>
            <select id="matchFormat" required>
              <option value="simple">‚ö° Score simple (un match)</option>
              <option value="home_away">üîÑ Aller-Retour (deux matchs)</option>
            </select>
          </div>

          <div class="form-group">
            <label>Description (optionnel)</label>
            <textarea id="tournamentDescription" rows="3" placeholder="D√©tails sur le tournoi..."></textarea>
          </div>

          <button type="submit" class="btn primary">Cr√©er le tournoi</button>
        </form>
      </div>
    </div>
  </main>

</div>

<!-- MODAL: D√©tails du tournoi -->
<div id="tournamentModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="modalTitle">Tournoi</h3>
      <button class="btn" onclick="closeTournamentModal()">‚úï</button>
    </div>
    <div class="modal-body">
      <div id="modalTournamentDetails"></div>
    </div>
    <div class="modal-footer">
      <button class="btn" onclick="closeTournamentModal()">Fermer</button>
    </div>
  </div>
</div>

<script>
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);
const API = (localStorage.getItem('efoot.api') || `${location.protocol}//${location.hostname}:3000`).replace(/\/+$/, '');
const token = localStorage.getItem('efoot.token');
const role = (localStorage.getItem('efoot.role') || 'member').toLowerCase();

if (!token) location.href = 'login.html';

// Afficher les √©l√©ments admin
$$('.adminOnly').forEach(el => el.style.display = (role === 'admin') ? '' : 'none');

// Th√®me
(function(){
  const k = 'efoot.theme';
  const apply = m => {
    document.documentElement.classList.toggle('light', m === 'light');
    localStorage.setItem(k, m);
    $('#theme').textContent = m === 'light' ? 'üåô' : '‚òÄÔ∏è';
  };
  apply(localStorage.getItem(k) || 'dark');
  $('#theme').onclick = () => apply(document.documentElement.classList.contains('light') ? 'dark' : 'light');
})();

// Logout
$('#logoutBtn')?.addEventListener('click', () => {
  if (confirm('Voulez-vous vraiment vous d√©connecter ?')) {
    ['efoot.token', 'efoot.role', 'efoot.expAt'].forEach(k => localStorage.removeItem(k));
    location.href = 'login.html';
  }
});

// Tabs
$$('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    const target = tab.dataset.tab;

    $$('.tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');

    $$('.tab-content').forEach(c => c.style.display = 'none');
    $(`[data-content="${target}"]`).style.display = 'block';
  });
});

// API helpers
async function apiCall(url, options = {}) {
  const response = await fetch(`${API}${url}`, {
    ...options,
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json',
      ...options.headers
    }
  });

  if (!response.ok) {
    const error = await response.json().catch(() => ({ error: 'Request failed' }));
    throw new Error(error.error || 'Request failed');
  }

  return response.json();
}

// Charger les tournois
async function loadTournaments() {
  try {
    const data = await apiCall('/tournaments');
    const tournaments = data.tournaments || [];

    const container = $('#tournamentList');

    if (tournaments.length === 0) {
      container.innerHTML = '<p style="color:var(--muted)">Aucun tournoi disponible</p>';
      return;
    }

    container.innerHTML = tournaments.map(t => {
      const statusClass = t.status === 'active' ? 'active' : t.status === 'closed' ? 'closed' : 'draft';
      const statusText = t.status === 'active' ? 'En cours' : t.status === 'closed' ? 'Termin√©' : 'Brouillon';

      return `
        <div class="tournament-card" onclick="viewTournament(${t.id})">
          <h4>${escapeHtml(t.name)}</h4>
          <div class="meta">
            <div><strong>Jeu:</strong> ${escapeHtml(t.game_type)}</div>
            <div><strong>Format:</strong> ${formatTypeLabel(t.format)}</div>
            <div><strong>Participants:</strong> ${t.participant_count || 0}</div>
          </div>
          <span class="status ${statusClass}">${statusText}</span>
        </div>
      `;
    }).join('');
  } catch (err) {
    console.error(err);
    alert('Erreur lors du chargement des tournois');
  }
}

function formatTypeLabel(format) {
  const labels = {
    'single_elimination': 'Simple √©limination',
    'double_elimination': 'Double √©limination',
    'round_robin': 'Round-Robin'
  };
  return labels[format] || format;
}

function escapeHtml(str) {
  const div = document.createElement('div');
  div.textContent = str || '';
  return div.innerHTML;
}

// Cr√©er un tournoi
$('#createTournamentForm')?.addEventListener('submit', async (e) => {
  e.preventDefault();

  const name = $('#tournamentName').value.trim();
  const game_type = $('#gameType').value.trim();
  const format = $('#tournamentFormat').value;
  const match_format = $('#matchFormat').value;
  const description = $('#tournamentDescription').value.trim();

  if (!name || !game_type || !format || !match_format) {
    alert('Veuillez remplir tous les champs obligatoires');
    return;
  }

  try {
    await apiCall('/tournaments', {
      method: 'POST',
      body: JSON.stringify({ name, game_type, format, match_format, description })
    });

    alert('Tournoi cr√©√© avec succ√®s !');
    $('#createTournamentForm').reset();

    // Retour √† la liste
    $('.tab[data-tab="list"]').click();
    loadTournaments();
  } catch (err) {
    console.error(err);
    alert('Erreur lors de la cr√©ation du tournoi: ' + err.message);
  }
});

// Voir les d√©tails d'un tournoi
async function viewTournament(id) {
  try {
    const data = await apiCall(`/tournaments/${id}`);
    const { tournament, participants, matches } = data;

    let html = `
      <div style="margin-bottom:20px">
        <h4 style="margin:0 0 8px">${escapeHtml(tournament.name)}</h4>
        <div style="font-size:14px;color:var(--muted)">
          <div><strong>Jeu:</strong> ${escapeHtml(tournament.game_type)}</div>
          <div><strong>Format:</strong> ${formatTypeLabel(tournament.format)}</div>
          <div><strong>Type de match:</strong> ${tournament.match_format === 'home_away' ? 'Aller-Retour' : 'Score simple'}</div>
          <div><strong>Statut:</strong> ${tournament.status === 'active' ? 'üü¢ En cours' : tournament.status === 'closed' ? 'üî¥ Termin√©' : '‚ö™ Brouillon'}</div>
        </div>
      </div>
    `;

    if (tournament.description) {
      html += `<div style="margin-bottom:20px;padding:12px;background:var(--card);border-radius:8px">${escapeHtml(tournament.description)}</div>`;
    }

    // Admin actions
    if (role === 'admin' && tournament.status === 'draft') {
      html += `
        <div style="margin-bottom:20px;padding:16px;background:var(--card);border:1px solid var(--border);border-radius:12px">
          <h5 style="margin:0 0 12px">Actions Admin</h5>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn" onclick="manageParticipants(${id})">üë• G√©rer participants</button>
            <button class="btn success" onclick="generateBracket(${id})">üéØ G√©n√©rer bracket</button>
            <button class="btn primary" onclick="startTournament(${id})">‚ñ∂Ô∏è D√©marrer tournoi</button>
            <button class="btn danger" onclick="deleteTournament(${id})">üóëÔ∏è Supprimer</button>
          </div>
        </div>
      `;
    }

    if (role === 'admin' && tournament.status === 'active') {
      html += `
        <div style="margin-bottom:20px;padding:16px;background:var(--card);border:1px solid var(--border);border-radius:12px">
          <h5 style="margin:0 0 12px">Actions Admin</h5>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn success" onclick="closeTournament(${id})">üèÅ Cl√¥turer tournoi</button>
          </div>
        </div>
      `;
    }

    // Participants
    html += `<h5 style="margin:20px 0 12px">Participants (${participants.length})</h5>`;
    if (participants.length > 0) {
      html += '<div class="participant-list">';
      participants.forEach(p => {
        html += `<div class="participant-item"><span>${escapeHtml(p.participant_name)}</span></div>`;
      });
      html += '</div>';
    } else {
      html += '<p style="color:var(--muted)">Aucun participant pour le moment</p>';
    }

    // Matchs
    if (matches.length > 0) {
      html += `<h5 style="margin:20px 0 12px">Matchs</h5>`;
      html += '<div class="match-list">';

      matches.forEach(m => {
        const isPlayed = m.winner_id !== null;
        const canEdit = role === 'admin' && tournament.status === 'active';

        html += `
          <div class="match-item">
            <div class="match-header">Tour ${m.round_number} - Match ${m.match_number}</div>
            <div class="match-players">
              <div class="match-player" style="${m.winner_id === m.participant1_id ? 'border:2px solid var(--ok);background:rgba(34,197,94,.1)' : ''}">${escapeHtml(m.p1_name || 'TBD')}</div>
              <div class="match-vs">VS</div>
              <div class="match-player" style="${m.winner_id === m.participant2_id ? 'border:2px solid var(--ok);background:rgba(34,197,94,.1)' : ''}">${escapeHtml(m.p2_name || 'TBD')}</div>
            </div>
            ${isPlayed ? `
              <div style="margin-top:12px;text-align:center;font-weight:700;color:var(--ok)">
                Gagnant: ${escapeHtml(m.winner_name)}
                ${tournament.match_format === 'home_away' ?
                  `<br><small>Aller: ${m.score1_home || 0} - ${m.score2_home || 0} | Retour: ${m.score1_away || 0} - ${m.score2_away || 0}</small>` :
                  `<br><small>Score: ${m.score1_home || 0} - ${m.score2_home || 0}</small>`
                }
              </div>
            ` : ''}
            ${canEdit && !isPlayed ? `
              <div style="margin-top:12px">
                <button class="btn primary" style="width:100%" onclick="enterMatchResult(${tournament.id}, ${m.id}, '${tournament.match_format}')">Saisir r√©sultat</button>
              </div>
            ` : ''}
          </div>
        `;
      });

      html += '</div>';
    }

    // Classement final (si termin√©)
    if (tournament.status === 'closed') {
      const standingsData = await apiCall(`/tournaments/${id}/standings`);

      if (tournament.format === 'round_robin' && standingsData.standings) {
        html += `<h5 style="margin:20px 0 12px">Classement Final</h5>`;
        if (standingsData.standings[0]) {
          html += `
            <div class="winner-banner">
              <div class="trophy">üèÜ</div>
              <div class="name">${escapeHtml(standingsData.standings[0].participant_name)}</div>
              <div class="subtitle">Vainqueur du tournoi</div>
            </div>
          `;
        }

        html += '<table style="width:100%;border-collapse:collapse;margin-top:16px"><thead><tr><th>Rang</th><th>Participant</th><th>Victoires</th><th>D√©faites</th><th>Points</th></tr></thead><tbody>';
        standingsData.standings.forEach((s, i) => {
          html += `<tr style="border-bottom:1px solid var(--border)"><td style="padding:10px;text-align:center">${i + 1}</td><td style="padding:10px">${escapeHtml(s.participant_name)}</td><td style="padding:10px;text-align:center">${s.wins}</td><td style="padding:10px;text-align:center">${s.losses}</td><td style="padding:10px;text-align:center;font-weight:700">${s.points}</td></tr>`;
        });
        html += '</tbody></table>';
      } else if (standingsData.winner) {
        html += `
          <div class="winner-banner">
            <div class="trophy">üèÜ</div>
            <div class="name">${escapeHtml(standingsData.winner)}</div>
            <div class="subtitle">Vainqueur du tournoi</div>
          </div>
        `;
      }
    }

    $('#modalTournamentDetails').innerHTML = html;
    $('#modalTitle').textContent = tournament.name;
    $('#tournamentModal').classList.add('active');
  } catch (err) {
    console.error(err);
    alert('Erreur lors du chargement du tournoi');
  }
}

function closeTournamentModal() {
  $('#tournamentModal').classList.remove('active');
}

// G√©rer les participants
function manageParticipants(tournamentId) {
  closeTournamentModal();

  const modal = document.createElement('div');
  modal.className = 'modal active';
  modal.innerHTML = `
    <div class="modal-content">
      <div class="modal-header">
        <h3>G√©rer les participants</h3>
        <button class="btn" onclick="this.closest('.modal').remove()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Nom du participant</label>
          <input type="text" id="newParticipantName" placeholder="Entrer le nom">
        </div>
        <button class="btn primary" onclick="addParticipant(${tournamentId})">Ajouter</button>

        <h5 style="margin-top:24px">Participants actuels</h5>
        <div id="currentParticipants">Chargement...</div>
      </div>
    </div>
  `;
  document.body.appendChild(modal);

  loadParticipantsForManagement(tournamentId);
}

async function loadParticipantsForManagement(tournamentId) {
  try {
    const data = await apiCall(`/tournaments/${tournamentId}`);
    const container = $('#currentParticipants');

    if (data.participants.length === 0) {
      container.innerHTML = '<p style="color:var(--muted)">Aucun participant</p>';
      return;
    }

    container.innerHTML = data.participants.map(p => `
      <div class="participant-item">
        <span>${escapeHtml(p.participant_name)}</span>
        <button class="btn danger" style="padding:6px 12px" onclick="removeParticipant(${tournamentId}, ${p.id})">Retirer</button>
      </div>
    `).join('');
  } catch (err) {
    console.error(err);
  }
}

async function addParticipant(tournamentId) {
  const name = $('#newParticipantName').value.trim();
  if (!name) {
    alert('Veuillez entrer un nom');
    return;
  }

  try {
    await apiCall(`/tournaments/${tournamentId}/participants`, {
      method: 'POST',
      body: JSON.stringify({ participant_name: name })
    });

    $('#newParticipantName').value = '';
    loadParticipantsForManagement(tournamentId);
  } catch (err) {
    alert('Erreur: ' + err.message);
  }
}

async function removeParticipant(tournamentId, participantId) {
  if (!confirm('√ätes-vous s√ªr de retirer ce participant ?')) return;

  try {
    await apiCall(`/tournaments/${tournamentId}/participants/${participantId}`, {
      method: 'DELETE'
    });

    loadParticipantsForManagement(tournamentId);
  } catch (err) {
    alert('Erreur: ' + err.message);
  }
}

async function generateBracket(tournamentId) {
  if (!confirm('G√©n√©rer le bracket ? Cela supprimera tous les matchs existants.')) return;

  try {
    await apiCall(`/tournaments/${tournamentId}/generate-bracket`, {
      method: 'POST'
    });

    alert('Bracket g√©n√©r√© avec succ√®s !');
    closeTournamentModal();
    viewTournament(tournamentId);
  } catch (err) {
    alert('Erreur: ' + err.message);
  }
}

async function startTournament(tournamentId) {
  if (!confirm('D√©marrer le tournoi ? Il passera en mode actif.')) return;

  try {
    await apiCall(`/tournaments/${tournamentId}`, {
      method: 'PUT',
      body: JSON.stringify({ status: 'active' })
    });

    alert('Tournoi d√©marr√© !');
    closeTournamentModal();
    loadTournaments();
    viewTournament(tournamentId);
  } catch (err) {
    alert('Erreur: ' + err.message);
  }
}

async function closeTournament(tournamentId) {
  if (!confirm('Cl√¥turer le tournoi ? Il ne pourra plus √™tre modifi√©.')) return;

  try {
    await apiCall(`/tournaments/${tournamentId}`, {
      method: 'PUT',
      body: JSON.stringify({ status: 'closed' })
    });

    alert('Tournoi cl√¥tur√© !');
    closeTournamentModal();
    loadTournaments();
    viewTournament(tournamentId);
  } catch (err) {
    alert('Erreur: ' + err.message);
  }
}

async function deleteTournament(tournamentId) {
  if (!confirm('‚ö†Ô∏è ATTENTION: Supprimer d√©finitivement ce tournoi ? Cette action est irr√©versible !')) return;

  try {
    await apiCall(`/tournaments/${tournamentId}`, {
      method: 'DELETE'
    });

    alert('Tournoi supprim√©');
    closeTournamentModal();
    loadTournaments();
  } catch (err) {
    alert('Erreur: ' + err.message);
  }
}

// Saisir r√©sultat de match
function enterMatchResult(tournamentId, matchId, matchFormat) {
  closeTournamentModal();

  const modal = document.createElement('div');
  modal.className = 'modal active';

  const isHomeAway = matchFormat === 'home_away';

  modal.innerHTML = `
    <div class="modal-content">
      <div class="modal-header">
        <h3>Saisir le r√©sultat</h3>
        <button class="btn" onclick="this.closest('.modal').remove()">‚úï</button>
      </div>
      <div class="modal-body">
        ${isHomeAway ? `
          <div class="form-group">
            <label>Score ALLER (Joueur 1 - Joueur 2)</label>
            <div style="display:flex;gap:12px;align-items:center">
              <input type="number" id="score1_home" min="0" placeholder="0" style="width:80px">
              <span>-</span>
              <input type="number" id="score2_home" min="0" placeholder="0" style="width:80px">
            </div>
          </div>

          <div class="form-group">
            <label>Score RETOUR (Joueur 1 - Joueur 2)</label>
            <div style="display:flex;gap:12px;align-items:center">
              <input type="number" id="score1_away" min="0" placeholder="0" style="width:80px">
              <span>-</span>
              <input type="number" id="score2_away" min="0" placeholder="0" style="width:80px">
            </div>
          </div>
        ` : `
          <div class="form-group">
            <label>Score (Joueur 1 - Joueur 2)</label>
            <div style="display:flex;gap:12px;align-items:center">
              <input type="number" id="score1_home" min="0" placeholder="0" style="width:80px">
              <span>-</span>
              <input type="number" id="score2_home" min="0" placeholder="0" style="width:80px">
            </div>
          </div>
        `}

        <div class="form-group">
          <label>ID du gagnant *</label>
          <input type="number" id="winnerId" placeholder="ID du participant gagnant" required>
        </div>

        <button class="btn primary" onclick="saveMatchResult(${tournamentId}, ${matchId}, ${isHomeAway})">Enregistrer</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);
}

async function saveMatchResult(tournamentId, matchId, isHomeAway) {
  const score1_home = parseInt($('#score1_home').value) || null;
  const score2_home = parseInt($('#score2_home').value) || null;
  const score1_away = isHomeAway ? (parseInt($('#score1_away').value) || null) : null;
  const score2_away = isHomeAway ? (parseInt($('#score2_away').value) || null) : null;
  const winner_id = parseInt($('#winnerId').value) || null;

  if (winner_id === null) {
    alert('Veuillez entrer l\'ID du gagnant');
    return;
  }

  try {
    await apiCall(`/tournaments/${tournamentId}/matches/${matchId}`, {
      method: 'PUT',
      body: JSON.stringify({ score1_home, score2_home, score1_away, score2_away, winner_id })
    });

    alert('R√©sultat enregistr√© !');
    document.querySelector('.modal.active').remove();
    viewTournament(tournamentId);
  } catch (err) {
    alert('Erreur: ' + err.message);
  }
}

// Initialisation
loadTournaments();
</script>

<footer style="text-align:center;padding:20px;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif">
  Copyright ¬© GOUZEPE GAMING CLUB 2025
</footer>
</body>
</html>
