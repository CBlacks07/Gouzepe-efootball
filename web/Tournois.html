<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<title>GOUZEPE eFOOTBALL ‚Äî Tournois</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="theme.css">
<link rel="stylesheet" href="mobile.css">
<script src="common.js"></script>

<style>
  :root{
    --bg:#0b1220;--panel:#0f1627;--card:#0c1426;--text:#e5e7eb;--muted:#94a3b8;--border:#1f2937;
    --brand:#16a34a;--accent:#2563eb; --champ:#ef4444; --ok:#16a34a; --ko:#ef4444; --mid:#64748b;
  }
  :root.light{--bg:#f4f6fb;--panel:#ffffff;--card:#ffffff;--text:#0f172a;--muted:#475569;--border:#e5e7eb;--accent:#1d4ed8}
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0;color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Trebuchet MS",sans-serif;
    background:
      radial-gradient(900px 600px at 20% 0%, rgba(96,165,250,.12), transparent 40%),
      radial-gradient(900px 600px at 80% 100%, rgba(34,197,94,.10), transparent 40%),
      linear-gradient(180deg, rgba(7,10,22,.94), rgba(15,23,42,.96)),
      url('assets/icons/apple-touch-icon.png') center/cover fixed no-repeat;
  }
  html.light body{
    background:
      radial-gradient(900px 600px at 20% 0%, rgba(96,165,250,.18), transparent 42%),
      radial-gradient(900px 600px at 80% 100%, rgba(34,197,94,.16), transparent 42%),
      linear-gradient(180deg, rgba(255,255,255,.86), rgba(245,247,251,.92)),
      url('assets/icons/apple-touch-icon.png') center/cover fixed no-repeat;
  }
  .wrap{max-width:1400px;margin:auto;padding:12px}

  .top{position:sticky;top:0;z-index:50;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:8px 6px;background:rgba(12,18,32,.55);backdrop-filter:blur(6px);border-radius:14px;margin-bottom:16px}
  html.light .top{background:rgba(255,255,255,.7)}

  .btn{border:1px solid var(--border);border-radius:12px;padding:10px 14px;background:#10192c;color:var(--text);cursor:pointer;font-size:14px;font-weight:600;transition:all 0.2s;display:inline-flex;align-items:center;gap:6px}
  html.light .btn{background:#fff}
  .btn:hover{background:var(--accent);border-color:var(--accent);color:#fff}
  .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
  .btn.danger{background:#7f1d1d;border-color:#7f1d1d;color:#fecaca}
  .btn.success{background:#14532d;border-color:#14532d;color:#d1fae5}
  .btn.ghost{background:transparent}

  .badge{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border:1px dashed var(--border);border-radius:999px;font-weight:600;opacity:.9;font-size:13px}
  .badge .dot{width:8px;height:8px;border-radius:50%;background:var(--brand)}

  input,select,textarea{border:1px solid var(--border);border-radius:12px;padding:10px 12px;background:#0b1020;color:var(--text);font-size:14px;width:100%}
  html.light input,html.light select,html.light textarea{background:#fff}

  .card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px}
  .card h3{margin:0 0 12px;font-size:18px;font-weight:800}

  .tournament-grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(320px, 1fr));gap:16px;margin-top:16px}
  .tournament-card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px;cursor:pointer;transition:all 0.2s}
  .tournament-card:hover{border-color:var(--accent);transform:translateY(-2px);box-shadow:0 4px 12px rgba(37,99,235,.2)}
  .tournament-card h4{margin:0 0 8px;font-size:16px;font-weight:700}
  .tournament-card .meta{font-size:12px;color:var(--muted);margin-bottom:8px}
  .tournament-card .status{display:inline-block;padding:4px 10px;border-radius:999px;font-size:11px;font-weight:700;text-transform:uppercase}
  .status.draft{background:rgba(100,116,139,.2);color:var(--muted)}
  .status.active{background:rgba(34,197,94,.2);color:var(--ok)}
  .status.closed{background:rgba(239,68,68,.2);color:var(--ko)}

  .accordion{background:var(--card);border:1px solid var(--border);border-radius:12px;margin-bottom:16px;overflow:hidden}
  .accordion-header{padding:16px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;font-weight:700;transition:background 0.2s}
  .accordion-header:hover{background:rgba(37,99,235,.1)}
  .accordion-icon{transition:transform 0.3s;font-weight:900}
  .accordion-icon.open{transform:rotate(180deg)}
  .accordion-content{max-height:0;overflow:hidden;transition:max-height 0.3s ease}
  .accordion-content.open{max-height:4000px}
  .accordion-body{padding:16px;border-top:1px solid var(--border)}

  .participants-inline{padding:12px;background:var(--card);border:1px solid var(--border);border-radius:8px;color:var(--text);line-height:1.6}
  .participants-inline .participant-tag{display:inline-block;background:rgba(37,99,235,.15);padding:4px 10px;border-radius:6px;margin:2px 4px;font-size:13px;font-weight:600}

  .form-group{margin-bottom:16px}
  .form-group label{display:block;margin-bottom:6px;font-weight:600;font-size:14px;color:var(--muted)}

  .tabs{display:flex;gap:8px;margin-bottom:20px;border-bottom:2px solid var(--border);flex-wrap:wrap}
  .tab{padding:12px 20px;cursor:pointer;font-weight:700;border-bottom:2px solid transparent;margin-bottom:-2px;transition:all 0.2s}
  .tab.active{border-bottom-color:var(--accent);color:var(--accent)}
  .tab:hover{color:var(--accent)}

  .winner-banner{background:linear-gradient(135deg, rgba(34,197,94,.2), rgba(16,185,129,.2));border:2px solid var(--ok);border-radius:14px;padding:24px;text-align:center;margin-top:20px}
  .winner-banner .trophy{font-size:48px;margin-bottom:12px}
  .winner-banner .name{font-size:32px;font-weight:900;color:var(--ok);margin-bottom:8px}
  .winner-banner .subtitle{font-size:16px;color:var(--muted)}

  .view{display:none}
  .view.active{display:block}

  .back-button{margin-bottom:16px}

  .admin-actions{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:16px}
  .admin-actions h5{margin:0 0 12px;font-size:14px;font-weight:700;color:var(--muted);text-transform:uppercase}
  .admin-actions .btn-group{display:flex;gap:8px;flex-wrap:wrap}

  .info-grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:12px;margin-bottom:20px}
  .info-item{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px}
  .info-label{font-size:12px;color:var(--muted);margin-bottom:4px}
  .info-value{font-size:16px;font-weight:700}

  /* BRACKET VISUEL STYLE CHALLONGE */
  .bracket-container{overflow-x:auto;padding:20px 0}
  .bracket{display:flex;gap:80px;min-width:min-content;position:relative}
  .bracket-round{display:flex;flex-direction:column;justify-content:space-around;min-width:180px}
  .bracket-round-title{text-align:center;font-weight:800;font-size:14px;color:var(--accent);margin-bottom:16px;text-transform:uppercase;letter-spacing:0.5px}
  .bracket-match{background:var(--panel);border:1px solid var(--border);border-radius:8px;margin:12px 0;position:relative;overflow:hidden;min-height:80px;display:flex;flex-direction:column}
  .bracket-player{padding:10px 12px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;font-size:13px;transition:all 0.2s}
  .bracket-player:last-child{border-bottom:none}
  .bracket-player.winner{background:rgba(34,197,94,.15);font-weight:700;color:var(--ok)}
  .bracket-player.loser{opacity:0.5}
  .bracket-player-name{flex:1;font-weight:600}
  .bracket-player-score{font-weight:900;font-size:15px;min-width:30px;text-align:right}
  .bracket-connector{position:absolute;top:50%;right:-40px;width:40px;height:2px;background:var(--border);z-index:1}
  .bracket-connector-v{position:absolute;right:-40px;width:2px;background:var(--border);z-index:1}

  /* Match input pour admin */
  .match-edit{padding:12px;background:var(--card);border-top:1px solid var(--border)}
  .match-input{display:grid;grid-template-columns:1fr auto 1fr;gap:8px;align-items:center;margin-bottom:8px}
  .match-input input{width:60px;text-align:center;font-weight:700;font-size:14px;padding:8px}

  @media (max-width: 760px){
    .tournament-grid{grid-template-columns:1fr}
    .admin-actions .btn-group{flex-direction:column}
    .admin-actions .btn{width:100%}
    .bracket{gap:40px}
    .bracket-round{min-width:140px}
    .bracket-connector{right:-20px;width:20px}
    .bracket-connector-v{right:-20px}
  }

  /* Navigation responsive */
  @media (min-width: 900px){
    .menu-toggle{display:none !important}
    .nav-desktop{display:flex !important}
  }

  @media (max-width: 899px){
    .menu-toggle{display:inline-flex !important}
    .nav-desktop{display:none !important}
  }
</style>
</head>
<body class="container">
<div class="wrap">

  <!-- TOP BAR -->
  <header class="top" id="topbar">
    <a class="brand" href="./Accueil.html" aria-label="Accueil GOUZEPE" style="text-decoration:none;color:inherit;display:flex;align-items:center;gap:10px">
      <img src="assets/icons/apple-touch-icon.png" alt="Logo" style="width:42px;height:42px;border-radius:12px">
      <div style="display:flex;flex-direction:column">
        <h1 style="margin:0;font-size:18px;font-weight:700">GOUZEPE eFOOTBALL</h1>
        <small style="color:var(--muted);font-size:13px">Tournois</small>
      </div>
    </a>

    <button id="menuToggle" class="menu-toggle" aria-controls="menu" aria-expanded="false" title="Ouvrir le menu de navigation">‚ò∞ Menu</button>

    <nav class="nav-desktop" aria-label="Navigation principale" style="display:none;gap:8px;align-items:center">
      <a class="btn ghost" href="./Accueil.html">üè† Accueil</a>
      <a class="btn ghost" href="./Duel.html">üí™üèΩ Duel</a>
      <a class="btn ghost" href="./Classement-general.html">üìä Classements</a>
      <a class="btn ghost" href="./Panel-Membre.html">üë§ Mon espace</a>
      <a class="btn ghost adminNav" href="./Admin-Joueurs.html" style="display:none">üë• Admin-Joueurs</a>
      <a class="btn ghost adminNav" href="./Admin-Utilisateurs.html" style="display:none">üõ°Ô∏è Admin Utilisateurs</a>
      <button id="logoutBtn" class="btn danger" type="button" title="Se d√©connecter de votre compte">D√©connexion</button>
    </nav>

    <div style="flex:1"></div>
    <div id="season-badge" class="badge" style="display:none"><span class="dot" style="width:8px;height:8px;border-radius:50%;background:var(--brand);margin-right:6px"></span><span id="season-top">Saison</span></div>
    <button id="theme" class="btn ghost" title="Basculer entre th√®me clair et sombre">‚òÄÔ∏è</button>
  </header>

  <!-- Menu Mobile -->
  <div id="mobileMenu" style="display:none;position:fixed;inset:0;z-index:60;background:rgba(0,0,0,.65);backdrop-filter:blur(4px);align-items:flex-start;justify-content:center;padding:0">
    <div style="width:min(94vw,400px);margin-top:0;background:var(--panel);color:var(--text);border:none;border-bottom-left-radius:16px;border-bottom-right-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,.4);padding:0;max-height:90vh;overflow-y:auto">
      <div style="font-weight:800;text-align:center;padding:16px;border-bottom:1px solid var(--border);margin:0;position:sticky;top:0;background:var(--panel);z-index:1">
        <span>Menu</span>
        <button id="mmClose" class="btn ghost" style="position:absolute;right:12px;top:12px;padding:6px 10px;font-size:18px;line-height:1" title="Fermer le menu">‚úï</button>
      </div>
      <div style="display:flex;flex-direction:column;gap:0;padding:8px">
        <a class="btn ghost" href="./Accueil.html" style="display:flex;align-items:center;justify-content:flex-start;gap:12px;padding:14px 16px;border-radius:12px">üè† Accueil</a>
        <a class="btn ghost" href="./Duel.html" style="display:flex;align-items:center;justify-content:flex-start;gap:12px;padding:14px 16px;border-radius:12px">üí™üèΩ Duel</a>
        <a class="btn ghost" href="./Classement-general.html" style="display:flex;align-items:center;justify-content:flex-start;gap:12px;padding:14px 16px;border-radius:12px">üìä Classements</a>
        <a class="btn ghost" href="./Tournois.html" style="display:flex;align-items:center;justify-content:flex-start;gap:12px;padding:14px 16px;border-radius:12px">üèÜ Tournois</a>
        <a class="btn ghost" href="./Panel-Membre.html" style="display:flex;align-items:center;justify-content:flex-start;gap:12px;padding:14px 16px;border-radius:12px">üë§ Mon espace</a>
        <a class="btn ghost adminOnly" href="./Admin-Joueurs.html" style="display:flex;align-items:center;justify-content:flex-start;gap:12px;padding:14px 16px;border-radius:12px">üë• Admin-Joueurs</a>
        <a class="btn ghost adminOnly" href="./Admin-Utilisateurs.html" style="display:flex;align-items:center;justify-content:flex-start;gap:12px;padding:14px 16px;border-radius:12px">üõ°Ô∏è Admin Utilisateurs</a>
      </div>
      <div style="display:flex;justify-content:center;padding:8px 16px;border-top:1px solid var(--border)">
        <button id="mmTheme" class="btn ghost" title="Basculer entre th√®me clair et sombre">‚òÄÔ∏è / üåô Th√®me</button>
      </div>
      <div style="display:flex;justify-content:center;padding:12px 16px;border-top:1px solid var(--border)">
        <button id="mmLogout" class="btn danger" style="width:100%" title="Se d√©connecter de votre compte">D√©connexion</button>
      </div>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <main>
    <!-- VIEW: Liste des tournois -->
    <div id="listView" class="view active">
      <div class="tabs">
        <div class="tab active" data-tab="all">üìã Tous les tournois</div>
        <div class="tab adminOnly" data-tab="create" style="display:none">‚ûï Cr√©er un tournoi</div>
      </div>

      <!-- TAB: Liste -->
      <div class="tab-content" data-content="all">
        <div class="card">
          <h3>Tournois disponibles</h3>
          <div id="tournamentList" class="tournament-grid">
            <p style="color:var(--muted)">Chargement...</p>
          </div>
        </div>
      </div>

      <!-- TAB: Cr√©er (admin) -->
      <div class="tab-content adminOnly" data-content="create" style="display:none">
        <div class="card">
          <h3>Cr√©er un nouveau tournoi</h3>
          <form id="createTournamentForm">
            <div class="form-group">
              <label>Nom du tournoi *</label>
              <input type="text" id="tournamentName" required placeholder="Gouzepe Cup">
            </div>

            <div class="form-group">
              <label>Type de jeu *</label>
              <input type="text" id="gameType" required placeholder="Ex: eFootball, Tekken 8, Street Fighter 6...">
            </div>

            <div class="form-group">
              <label>Format du tournoi *</label>
              <select id="tournamentFormat" required onchange="toggleFormatOptions()">
                <option value="">-- Choisir --</option>
                <option value="single_elimination">üèÜ Simple √©limination</option>
                <option value="double_elimination">üèÖ Double √©limination</option>
                <option value="round_robin">üîÑ Round-Robin (tous contre tous)</option>
                <option value="groups">‚öΩ Poules + √âlimination directe</option>
              </select>
            </div>

            <div class="form-group" id="loserBracketOption" style="display:none">
              <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
                <input type="checkbox" id="hasLoserBracket">
                <span>üèÖ Activer le Loser Bracket (comme sur Challonge)</span>
              </label>
              <p style="font-size:12px;color:var(--muted);margin-top:6px">
                Les perdants auront une seconde chance dans un bracket s√©par√©. Le gagnant du loser bracket affrontera le gagnant du winner bracket en grande finale.
              </p>
            </div>

            <div class="form-group" id="groupsOption" style="display:none">
              <label>Nombre de poules</label>
              <select id="numGroups">
                <option value="2">2 poules</option>
                <option value="4" selected>4 poules</option>
                <option value="6">6 poules</option>
                <option value="8">8 poules</option>
              </select>
              <p style="font-size:12px;color:var(--muted);margin-top:6px">
                üí° Phase de poules (round-robin dans chaque poule) puis phase √† √©limination directe avec les meilleurs.
              </p>
            </div>

            <div class="form-group">
              <label>Format des matchs *</label>
              <select id="matchFormat" required>
                <option value="simple">‚ö° Score simple (un match)</option>
                <option value="home_away">üîÑ Aller-Retour (deux matchs)</option>
              </select>
            </div>

            <div class="form-group">
              <label>Description (optionnel)</label>
              <textarea id="tournamentDescription" rows="3" placeholder="D√©tails sur le tournoi..."></textarea>
            </div>

            <button type="submit" class="btn primary" title="Cr√©er ce nouveau tournoi">‚ú® Cr√©er le tournoi</button>
          </form>
        </div>
      </div>
    </div>

    <!-- VIEW: D√©tails du tournoi -->
    <div id="detailView" class="view">
      <button class="btn back-button" onclick="backToList()" title="Retourner √† la liste des tournois">‚Üê Retour √† la liste</button>

      <div id="tournamentDetails"></div>
    </div>
  </main>

</div>

<script>
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);
const API = (localStorage.getItem('efoot.api') || `${location.protocol}//${location.hostname}:3000`).replace(/\/+$/, '');
const token = localStorage.getItem('efoot.token');
const role = (localStorage.getItem('efoot.role') || 'member').toLowerCase();

if (!token) location.href = 'login.html';

// Afficher les √©l√©ments admin
$$('.adminOnly').forEach(el => el.style.display = (role === 'admin') ? '' : 'none');
$$('.adminNav').forEach(el => el.style.display = (role === 'admin') ? '' : 'none');

// Th√®me
(function(){
  const k = 'efoot.theme';
  const apply = m => {
    document.documentElement.classList.toggle('light', m === 'light');
    localStorage.setItem(k, m);
    $('#theme').textContent = m === 'light' ? 'üåô' : '‚òÄÔ∏è';
  };
  apply(localStorage.getItem(k) || 'dark');
  $('#theme').onclick = () => apply(document.documentElement.classList.contains('light') ? 'dark' : 'light');
})();

// Logout
$('#logoutBtn')?.addEventListener('click', () => {
  if (confirm('Voulez-vous vraiment vous d√©connecter ?')) {
    ['efoot.token', 'efoot.role', 'efoot.expAt'].forEach(k => localStorage.removeItem(k));
    location.href = 'login.html';
  }
});

// Menu mobile
const mobileMenu = $('#mobileMenu');
const menuToggle = $('#menuToggle');
const mmClose = $('#mmClose');

menuToggle?.addEventListener('click', () => {
  mobileMenu.style.display = 'flex';
});

mmClose?.addEventListener('click', () => {
  mobileMenu.style.display = 'none';
});

mobileMenu?.addEventListener('click', (e) => {
  if (e.target === mobileMenu) {
    mobileMenu.style.display = 'none';
  }
});

// Th√®me mobile
$('#mmTheme')?.addEventListener('click', () => {
  $('#theme').click();
});

// Logout mobile
$('#mmLogout')?.addEventListener('click', () => {
  if (confirm('Voulez-vous vraiment vous d√©connecter ?')) {
    ['efoot.token', 'efoot.role', 'efoot.expAt'].forEach(k => localStorage.removeItem(k));
    location.href = 'login.html';
  }
});

// Tabs
$$('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    const target = tab.dataset.tab;
    const parent = tab.closest('.tabs');
    parent.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');

    const container = parent.nextElementSibling.parentElement;
    container.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
    container.querySelector(`[data-content="${target}"]`).style.display = 'block';
  });
});

// API helpers
async function apiCall(url, options = {}) {
  const response = await fetch(`${API}${url}`, {
    ...options,
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json',
      ...options.headers
    }
  });

  if (!response.ok) {
    const error = await response.json().catch(() => ({ error: 'Request failed' }));
    throw new Error(error.error || 'Request failed');
  }

  return response.json();
}

function escapeHtml(str) {
  const div = document.createElement('div');
  div.textContent = str || '';
  return div.innerHTML;
}

function formatTypeLabel(format) {
  const labels = {
    'single_elimination': 'Simple √©limination',
    'double_elimination': 'Double √©limination',
    'round_robin': 'Round-Robin'
  };
  return labels[format] || format;
}

// Navigation
function backToList() {
  $('#listView').classList.add('active');
  $('#detailView').classList.remove('active');
  loadTournaments();
}

// Afficher/masquer options selon le format
function toggleFormatOptions() {
  const format = $('#tournamentFormat').value;
  const loserOption = $('#loserBracketOption');
  const groupsOption = $('#groupsOption');

  // Loser bracket pour double elimination
  if (format === 'double_elimination') {
    loserOption.style.display = 'block';
  } else {
    loserOption.style.display = 'none';
    $('#hasLoserBracket').checked = false;
  }

  // Options de poules
  if (format === 'groups') {
    groupsOption.style.display = 'block';
  } else {
    groupsOption.style.display = 'none';
  }
}

// Charger les tournois
async function loadTournaments() {
  try {
    const data = await apiCall('/tournaments');
    const tournaments = data.tournaments || [];

    const container = $('#tournamentList');

    if (tournaments.length === 0) {
      container.innerHTML = '<p style="color:var(--muted)">Aucun tournoi disponible</p>';
      return;
    }

    container.innerHTML = tournaments.map(t => {
      const statusClass = t.status === 'active' ? 'active' : t.status === 'closed' ? 'closed' : 'draft';
      const statusText = t.status === 'active' ? 'En cours' : t.status === 'closed' ? 'Termin√©' : 'Brouillon';

      return `
        <div class="tournament-card" onclick="viewTournament(${t.id})">
          <h4>${escapeHtml(t.name)}</h4>
          <div class="meta">
            <div><strong>Jeu:</strong> ${escapeHtml(t.game_type)}</div>
            <div><strong>Format:</strong> ${formatTypeLabel(t.format)}</div>
            <div><strong>Participants:</strong> ${t.participant_count || 0}</div>
          </div>
          <span class="status ${statusClass}">${statusText}</span>
        </div>
      `;
    }).join('');
  } catch (err) {
    console.error(err);
    alert('Erreur lors du chargement des tournois');
  }
}

// Cr√©er un tournoi
$('#createTournamentForm')?.addEventListener('submit', async (e) => {
  e.preventDefault();

  const name = $('#tournamentName').value.trim();
  const game_type = $('#gameType').value.trim();
  const format = $('#tournamentFormat').value;
  const match_format = $('#matchFormat').value;
  const description = $('#tournamentDescription').value.trim();
  const has_loser_bracket = (format === 'double_elimination') && $('#hasLoserBracket').checked;

  if (!name || !game_type || !format || !match_format) {
    alert('Veuillez remplir tous les champs obligatoires');
    return;
  }

  try {
    await apiCall('/tournaments', {
      method: 'POST',
      body: JSON.stringify({ name, game_type, format, match_format, description, has_loser_bracket })
    });

    alert('‚úÖ Tournoi cr√©√© avec succ√®s !');
    $('#createTournamentForm').reset();
    toggleFormatOptions(); // Reset l'affichage

    // Retour √† la liste
    $('.tab[data-tab="all"]').click();
    loadTournaments();
  } catch (err) {
    console.error(err);
    alert('‚ùå Erreur: ' + err.message);
  }
});

// Voir les d√©tails d'un tournoi
let currentTournament = null;

async function viewTournament(id) {
  try {
    const data = await apiCall(`/tournaments/${id}`);
    currentTournament = data;

    renderTournamentDetails(data);

    $('#listView').classList.remove('active');
    $('#detailView').classList.add('active');
  } catch (err) {
    console.error(err);
    alert('Erreur lors du chargement du tournoi');
  }
}

function renderTournamentDetails(data) {
  const { tournament, participants, matches } = data;

  let html = `
    <div class="card">
      <h3>${escapeHtml(tournament.name)}</h3>

      <div class="info-grid">
        <div class="info-item">
          <div class="info-label">Jeu</div>
          <div class="info-value">${escapeHtml(tournament.game_type)}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Format</div>
          <div class="info-value">${formatTypeLabel(tournament.format)}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Type de match</div>
          <div class="info-value">${tournament.match_format === 'home_away' ? 'Aller-Retour' : 'Score simple'}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Statut</div>
          <div class="info-value">
            <span class="status ${tournament.status}">${tournament.status === 'active' ? 'En cours' : tournament.status === 'closed' ? 'Termin√©' : 'Brouillon'}</span>
          </div>
        </div>
      </div>

      ${tournament.description ? `<p style="color:var(--muted);margin-top:12px">${escapeHtml(tournament.description)}</p>` : ''}
    </div>
  `;

  // Admin actions
  if (role === 'admin' && tournament.status === 'draft') {
    html += `
      <div class="admin-actions">
        <h5>Actions Admin</h5>
        <div class="btn-group">
          ${participants.length >= 2 ? `<button class="btn" style="background:#7c3aed;border-color:#7c3aed;color:#fff" onclick="shuffleParticipants(${tournament.id})">üîÄ M√©langer participants</button>` : ''}
          <button class="btn success" onclick="generateBracket(${tournament.id})">üéØ G√©n√©rer bracket</button>
          <button class="btn primary" onclick="startTournament(${tournament.id})">‚ñ∂Ô∏è D√©marrer tournoi</button>
          <button class="btn danger" onclick="deleteTournament(${tournament.id})">üóëÔ∏è Supprimer</button>
        </div>
      </div>
    `;
  }

  if (role === 'admin' && tournament.status === 'active') {
    html += `
      <div class="admin-actions">
        <h5>Actions Admin</h5>
        <div class="btn-group">
          <button class="btn success" onclick="closeTournament(${tournament.id})">üèÅ Cl√¥turer tournoi</button>
          <button class="btn danger" onclick="deleteTournament(${tournament.id})">üóëÔ∏è Supprimer</button>
        </div>
      </div>
    `;
  }

  // Permettre la suppression m√™me pour les tournois cl√¥tur√©s
  if (role === 'admin' && tournament.status === 'closed') {
    html += `
      <div class="admin-actions">
        <h5>Actions Admin</h5>
        <div class="btn-group">
          <button class="btn danger" onclick="deleteTournament(${tournament.id})">üóëÔ∏è Supprimer ce tournoi</button>
        </div>
      </div>
    `;
  }

  // Participants (inline avec virgules)
  html += `
    <div class="accordion">
      <div class="accordion-header" onclick="toggleAccordion(this)">
        <span>üë• Participants (${participants.length})</span>
        <span class="accordion-icon">‚ñº</span>
      </div>
      <div class="accordion-content">
        <div class="accordion-body">
          ${role === 'admin' && tournament.status === 'draft' ? `
            <div style="margin-bottom:16px">
              <div style="display:flex;gap:8px">
                <input type="text" id="newParticipantName" placeholder="Noms (s√©parez par des virgules pour ajouter plusieurs)" style="flex:1">
                <button class="btn primary" onclick="addParticipant(${tournament.id})">Ajouter</button>
              </div>
              <p style="font-size:11px;color:var(--muted);margin-top:4px">üí° Astuce : Ajoutez plusieurs participants d'un coup en les s√©parant par des virgules (ex: "Joueur1, Joueur2, Joueur3")</p>
            </div>
          ` : ''}

          ${participants.length > 0 ? `
            <div class="participants-inline">
              ${participants.map(p => `<span class="participant-tag">${escapeHtml(p.participant_name)}</span>`).join('')}
              ${role === 'admin' && tournament.status === 'draft' ? `
                <div style="margin-top:12px;padding-top:12px;border-top:1px solid var(--border)">
                  ${participants.map(p => `
                    <div style="display:inline-flex;align-items:center;gap:6px;margin:4px">
                      <span style="font-size:13px">${escapeHtml(p.participant_name)}</span>
                      <button class="btn danger" style="padding:4px 8px;font-size:11px" onclick="removeParticipant(${tournament.id}, ${p.id})">‚úï</button>
                    </div>
                  `).join('')}
                </div>
              ` : ''}
            </div>
          ` : '<p style="color:var(--muted)">Aucun participant</p>'}
        </div>
      </div>
    </div>
  `;

  // Bracket visuel
  if (matches.length > 0 && (tournament.format === 'single_elimination' || tournament.format === 'double_elimination')) {
    html += renderBracketView(matches, tournament);
  } else if (matches.length > 0 && tournament.format === 'round_robin') {
    html += renderRoundRobinMatches(matches, tournament);
  } else if (matches.length > 0 && tournament.format === 'groups') {
    html += renderGroupsMatches(matches, participants, tournament);
  } else if (participants.length >= 2 && role === 'admin' && tournament.status === 'draft') {
    html += `<p style="color:var(--muted);text-align:center;padding:20px">G√©n√©rez le bracket pour cr√©er les matchs</p>`;
  }

  // Classement final
  if (tournament.status === 'closed') {
    html += renderFinalStandings(tournament.id);
  }

  $('#tournamentDetails').innerHTML = html;
}

// Affichage bracket visuel style Challonge
function renderBracketView(matches, tournament) {
  // S√©parer par type de bracket
  const winnerMatches = matches.filter(m => m.bracket_type === 'winner' || !m.bracket_type);
  const loserMatches = matches.filter(m => m.bracket_type === 'loser');
  const grandFinalMatches = matches.filter(m => m.bracket_type === 'grand_final');

  let html = '';

  // === WINNER BRACKET ===
  if (winnerMatches.length > 0) {
    html += renderSingleBracket(winnerMatches, tournament, 'üèÜ Winner Bracket');
  }

  // === LOSER BRACKET ===
  if (loserMatches.length > 0) {
    html += renderSingleBracket(loserMatches, tournament, 'ü•à Loser Bracket (Seconde Chance)');
  }

  // === GRAND FINAL ===
  if (grandFinalMatches.length > 0) {
    html += renderSingleBracket(grandFinalMatches, tournament, 'üëë Grande Finale');
  }

  return html;
}

// Affichage d'un bracket (winner, loser, ou grand final)
function renderSingleBracket(matches, tournament, title) {
  // Grouper par round
  const rounds = {};
  matches.forEach(m => {
    if (!rounds[m.round_number]) rounds[m.round_number] = [];
    rounds[m.round_number].push(m);
  });

  const roundNumbers = Object.keys(rounds).sort((a, b) => a - b);
  const roundLabels = ['8√®mes', 'Quarts', 'Demi-finales', 'Finale'];

  let html = `
    <div class="card">
      <h3>${title}</h3>
      <div class="bracket-container">
        <div class="bracket">
  `;

  roundNumbers.forEach((roundNum, idx) => {
    const label = roundLabels[roundLabels.length - roundNumbers.length + idx] || `Tour ${roundNum}`;

    html += `
      <div class="bracket-round">
        <div class="bracket-round-title">${label}</div>
    `;

    rounds[roundNum].forEach(m => {
      // Ne pas afficher les matchs o√π les deux participants sont TBD (encore vides)
      if (!m.participant1_id && !m.participant2_id) return;

      const isPlayed = m.winner_id !== null;
      const canEdit = role === 'admin' && tournament.status === 'active' && !isPlayed && m.participant1_id && m.participant2_id;
      const isHomeAway = tournament.match_format === 'home_away';

      const p1Score = isHomeAway ?
        ((m.score1_home || 0) + (m.score1_away || 0)) :
        (m.score1_home || 0);
      const p2Score = isHomeAway ?
        ((m.score2_home || 0) + (m.score2_away || 0)) :
        (m.score2_home || 0);

      html += `
        <div class="bracket-match">
          <div class="bracket-player ${m.winner_id === m.participant1_id ? 'winner' : isPlayed ? 'loser' : ''}">
            <span class="bracket-player-name">${escapeHtml(m.p1_name || 'TBD')}</span>
            ${isPlayed ? `<span class="bracket-player-score">${p1Score}</span>` : ''}
          </div>
          <div class="bracket-player ${m.winner_id === m.participant2_id ? 'winner' : isPlayed ? 'loser' : ''}">
            <span class="bracket-player-name">${escapeHtml(m.p2_name || 'TBD')}</span>
            ${isPlayed ? `<span class="bracket-player-score">${p2Score}</span>` : ''}
          </div>

          ${canEdit ? `
            <div class="match-edit">
              <div class="match-input">
                <input type="number" min="0" placeholder="${m.p1_name || 'J1'}" id="score_${m.id}_1">
                <span style="font-weight:900;color:var(--accent)">-</span>
                <input type="number" min="0" placeholder="${m.p2_name || 'J2'}" id="score_${m.id}_2">
              </div>
              ${isHomeAway ? `
                <div class="match-input">
                  <input type="number" min="0" placeholder="Retour" id="score_${m.id}_1_away">
                  <span style="font-weight:900;color:var(--accent)">-</span>
                  <input type="number" min="0" placeholder="Retour" id="score_${m.id}_2_away">
                </div>
              ` : ''}
              <button class="btn primary" style="width:100%;padding:6px;font-size:12px" onclick="saveMatchResult(${tournament.id}, ${m.id}, ${m.participant1_id}, ${m.participant2_id}, ${isHomeAway})">
                üíæ Sauver
              </button>
            </div>
          ` : ''}
        </div>
      `;
    });

    html += `</div>`;
  });

  html += `
        </div>
      </div>
    </div>
  `;

  return html;
}

// Round-robin : affichage simple des matchs
function renderRoundRobinMatches(matches, tournament) {
  let html = `
    <div class="accordion">
      <div class="accordion-header" onclick="toggleAccordion(this)">
        <span>‚öîÔ∏è Tous les matchs (${matches.length})</span>
        <span class="accordion-icon">‚ñº</span>
      </div>
      <div class="accordion-content">
        <div class="accordion-body">
          <div style="display:grid;gap:12px">
  `;

  matches.forEach(m => {
    const isPlayed = m.winner_id !== null;
    const canEdit = role === 'admin' && tournament.status === 'active' && !isPlayed;
    const isHomeAway = tournament.match_format === 'home_away';

    html += `
      <div class="bracket-match">
        <div class="bracket-player ${m.winner_id === m.participant1_id ? 'winner' : isPlayed ? 'loser' : ''}">
          <span class="bracket-player-name">${escapeHtml(m.p1_name || 'TBD')}</span>
          ${isPlayed ? `<span class="bracket-player-score">${isHomeAway ? ((m.score1_home||0) + (m.score1_away||0)) : (m.score1_home||0)}</span>` : ''}
        </div>
        <div class="bracket-player ${m.winner_id === m.participant2_id ? 'winner' : isPlayed ? 'loser' : ''}">
          <span class="bracket-player-name">${escapeHtml(m.p2_name || 'TBD')}</span>
          ${isPlayed ? `<span class="bracket-player-score">${isHomeAway ? ((m.score2_home||0) + (m.score2_away||0)) : (m.score2_home||0)}</span>` : ''}
        </div>

        ${canEdit ? `
          <div class="match-edit">
            <div class="match-input">
              <input type="number" min="0" placeholder="${m.p1_name || 'J1'}" id="score_${m.id}_1">
              <span style="font-weight:900;color:var(--accent)">-</span>
              <input type="number" min="0" placeholder="${m.p2_name || 'J2'}" id="score_${m.id}_2">
            </div>
            ${isHomeAway ? `
              <div class="match-input">
                <input type="number" min="0" placeholder="Retour" id="score_${m.id}_1_away">
                <span style="font-weight:900;color:var(--accent)">-</span>
                <input type="number" min="0" placeholder="Retour" id="score_${m.id}_2_away">
              </div>
            ` : ''}
            <button class="btn primary" style="width:100%;padding:6px;font-size:12px" onclick="saveMatchResult(${tournament.id}, ${m.id}, ${m.participant1_id}, ${m.participant2_id}, ${isHomeAway})">
              üíæ Sauver
            </button>
          </div>
        ` : ''}
      </div>
    `;
  });

  html += `
          </div>
        </div>
      </div>
    </div>
  `;

  return html;
}

// Affichage des matchs par poules (groups)
function renderGroupsMatches(matches, participants, tournament) {
  // Grouper les participants par groupe
  const groups = {};
  participants.forEach(p => {
    if (p.group_id) {
      if (!groups[p.group_id]) {
        groups[p.group_id] = { participants: [], matches: [], name: `Groupe ${Object.keys(groups).length + 1}` };
      }
      groups[p.group_id].participants.push(p);
    }
  });

  // Grouper les matchs par groupe
  matches.forEach(m => {
    if (m.group_id && groups[m.group_id] && !m.is_knockout) {
      groups[m.group_id].matches.push(m);
    }
  });

  // Matchs de knockout (phase finale)
  const knockoutMatches = matches.filter(m => m.is_knockout);

  let html = '<div class="card"><h3>‚öΩ Phase de Poules</h3>';

  // Afficher chaque poule
  Object.values(groups).forEach((group, idx) => {
    const groupLetter = String.fromCharCode(65 + idx); // A, B, C, D...

    html += `
      <div class="accordion">
        <div class="accordion-header" onclick="toggleAccordion(this)">
          <span>Groupe ${groupLetter} (${group.participants.length} participants)</span>
          <span class="accordion-icon">‚ñº</span>
        </div>
        <div class="accordion-content">
          <div class="accordion-body">
            <div style="margin-bottom:16px">
              <strong>Participants:</strong>
              <div class="participants-inline">
                ${group.participants.map(p => `<span class="participant-tag">${escapeHtml(p.participant_name)}</span>`).join('')}
              </div>
            </div>

            <div style="display:grid;gap:12px">
    `;

    group.matches.forEach(m => {
      const isPlayed = m.winner_id !== null;
      const canEdit = role === 'admin' && tournament.status === 'active' && !isPlayed;
      const isHomeAway = tournament.match_format === 'home_away';

      html += `
        <div class="bracket-match">
          <div class="bracket-player ${m.winner_id === m.participant1_id ? 'winner' : isPlayed ? 'loser' : ''}">
            <span class="bracket-player-name">${escapeHtml(m.p1_name || 'TBD')}</span>
            ${isPlayed ? `<span class="bracket-player-score">${isHomeAway ? ((m.score1_home||0) + (m.score1_away||0)) : (m.score1_home||0)}</span>` : ''}
          </div>
          <div class="bracket-player ${m.winner_id === m.participant2_id ? 'winner' : isPlayed ? 'loser' : ''}">
            <span class="bracket-player-name">${escapeHtml(m.p2_name || 'TBD')}</span>
            ${isPlayed ? `<span class="bracket-player-score">${isHomeAway ? ((m.score2_home||0) + (m.score2_away||0)) : (m.score2_home||0)}</span>` : ''}
          </div>

          ${canEdit ? `
            <div class="match-edit">
              <div class="match-input">
                <input type="number" min="0" placeholder="${m.p1_name || 'J1'}" id="score_${m.id}_1">
                <span style="font-weight:900;color:var(--accent)">-</span>
                <input type="number" min="0" placeholder="${m.p2_name || 'J2'}" id="score_${m.id}_2">
              </div>
              ${isHomeAway ? `
                <div class="match-input">
                  <input type="number" min="0" placeholder="Retour" id="score_${m.id}_1_away">
                  <span style="font-weight:900;color:var(--accent)">-</span>
                  <input type="number" min="0" placeholder="Retour" id="score_${m.id}_2_away">
                </div>
              ` : ''}
              <button class="btn primary" style="width:100%;padding:6px;font-size:12px" onclick="saveMatchResult(${tournament.id}, ${m.id}, ${m.participant1_id}, ${m.participant2_id}, ${isHomeAway})">
                üíæ Sauver
              </button>
            </div>
          ` : ''}
        </div>
      `;
    });

    html += `
            </div>
          </div>
        </div>
      </div>
    `;
  });

  html += '</div>';

  // Phase √† √©limination directe (si matchs knockout g√©n√©r√©s)
  if (knockoutMatches.length > 0) {
    html += renderBracketView(knockoutMatches, tournament);
  }

  return html;
}

function renderFinalStandings(tournamentId) {
  setTimeout(async () => {
    try {
      const standingsData = await apiCall(`/tournaments/${tournamentId}/standings`);
      const tournament = currentTournament.tournament;

      let html = '';

      if (tournament.format === 'round_robin' && standingsData.standings) {
        if (standingsData.standings[0]) {
          html += `
            <div class="winner-banner">
              <div class="trophy">üèÜ</div>
              <div class="name">${escapeHtml(standingsData.standings[0].participant_name)}</div>
              <div class="subtitle">Vainqueur du tournoi</div>
            </div>
          `;
        }

        html += `
          <div class="card" style="margin-top:16px">
            <h3>Classement Final</h3>
            <table style="width:100%;border-collapse:collapse">
              <thead>
                <tr style="border-bottom:2px solid var(--border)">
                  <th style="padding:10px;text-align:left">Rang</th>
                  <th style="padding:10px;text-align:left">Participant</th>
                  <th style="padding:10px;text-align:center">V</th>
                  <th style="padding:10px;text-align:center">D</th>
                  <th style="padding:10px;text-align:center;font-weight:900">Points</th>
                </tr>
              </thead>
              <tbody>
                ${standingsData.standings.map((s, i) => `
                  <tr style="border-bottom:1px solid var(--border)">
                    <td style="padding:10px;font-weight:700">${i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : i + 1}</td>
                    <td style="padding:10px;font-weight:700">${escapeHtml(s.participant_name)}</td>
                    <td style="padding:10px;text-align:center;color:var(--ok)">${s.wins}</td>
                    <td style="padding:10px;text-align:center;color:var(--ko)">${s.losses}</td>
                    <td style="padding:10px;text-align:center;font-weight:900;font-size:18px;color:var(--accent)">${s.points}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        `;
      } else if (standingsData.winner) {
        html += `
          <div class="winner-banner">
            <div class="trophy">üèÜ</div>
            <div class="name">${escapeHtml(standingsData.winner)}</div>
            <div class="subtitle">Vainqueur du tournoi</div>
          </div>
        `;
      }

      if (html) {
        $('#tournamentDetails').insertAdjacentHTML('beforeend', html);
      }
    } catch (err) {
      console.error(err);
    }
  }, 100);

  return '';
}

// Accord√©on
function toggleAccordion(header) {
  const content = header.nextElementSibling;
  const icon = header.querySelector('.accordion-icon');

  content.classList.toggle('open');
  icon.classList.toggle('open');
}

// Gestion participants (supporte l'ajout multiple s√©par√© par virgules)
async function addParticipant(tournamentId) {
  const input = $('#newParticipantName').value.trim();
  if (!input) {
    alert('Veuillez entrer au moins un nom');
    return;
  }

  // S√©parer par virgules et nettoyer
  const names = input.split(',').map(n => n.trim()).filter(n => n.length > 0);

  if (names.length === 0) {
    alert('Veuillez entrer au moins un nom valide');
    return;
  }

  try {
    // Ajouter tous les participants en parall√®le
    const promises = names.map(name =>
      apiCall(`/tournaments/${tournamentId}/participants`, {
        method: 'POST',
        body: JSON.stringify({ participant_name: name })
      })
    );

    await Promise.all(promises);

    const count = names.length;
    alert(`‚úÖ ${count} participant${count > 1 ? 's ajout√©s' : ' ajout√©'} avec succ√®s !`);

    $('#newParticipantName').value = '';
    viewTournament(tournamentId);
  } catch (err) {
    alert('Erreur: ' + err.message);
  }
}

async function removeParticipant(tournamentId, participantId) {
  if (!confirm('√ätes-vous s√ªr de retirer ce participant ?')) return;

  try {
    await apiCall(`/tournaments/${tournamentId}/participants/${participantId}`, {
      method: 'DELETE'
    });

    viewTournament(tournamentId);
  } catch (err) {
    alert('Erreur: ' + err.message);
  }
}

// M√©langer les participants (shuffle)
async function shuffleParticipants(tournamentId) {
  if (!confirm('üîÄ M√©langer al√©atoirement l\'ordre des participants ?')) return;

  try {
    await apiCall(`/tournaments/${tournamentId}/shuffle-participants`, {
      method: 'POST'
    });

    alert('‚úÖ Participants m√©lang√©s avec succ√®s !');
    viewTournament(tournamentId);
  } catch (err) {
    alert('‚ùå Erreur: ' + err.message);
  }
}

// Bracket
async function generateBracket(tournamentId) {
  const tournament = currentTournament?.tournament;
  if (!tournament) return;

  // Pour le format groups, demander le nombre de poules
  let body = {};
  if (tournament.format === 'groups') {
    const numGroups = prompt('Combien de poules ? (2-8)', '4');
    if (!numGroups) return;

    const knockoutFormat = confirm('Phase √† √©limination :\nOK = Simple √©limination\nAnnuler = Double √©limination')
      ? 'single_elimination'
      : 'double_elimination';

    body = {
      num_groups: parseInt(numGroups),
      knockout_format: knockoutFormat
    };
  }

  if (!confirm('G√©n√©rer le bracket ? Cela supprimera tous les matchs existants.')) return;

  try {
    await apiCall(`/tournaments/${tournamentId}/generate-bracket`, {
      method: 'POST',
      body: JSON.stringify(body)
    });

    alert('‚úÖ Bracket g√©n√©r√© avec succ√®s !');
    viewTournament(tournamentId);
  } catch (err) {
    alert('‚ùå Erreur: ' + err.message);
  }
}

// Saisir r√©sultat (avec d√©tection automatique du gagnant)
async function saveMatchResult(tournamentId, matchId, p1Id, p2Id, isHomeAway) {
  // ‚úÖ FIX: Permettre 0 comme score valide
  const val1 = $(`#score_${matchId}_1`).value;
  const val2 = $(`#score_${matchId}_2`).value;
  const val1_away = isHomeAway ? $(`#score_${matchId}_1_away`).value : null;
  const val2_away = isHomeAway ? $(`#score_${matchId}_2_away`).value : null;

  const score1_home = val1 !== '' ? parseInt(val1) : null;
  const score2_home = val2 !== '' ? parseInt(val2) : null;
  const score1_away = isHomeAway && val1_away !== '' ? parseInt(val1_away) : null;
  const score2_away = isHomeAway && val2_away !== '' ? parseInt(val2_away) : null;

  if (score1_home === null || score2_home === null || isNaN(score1_home) || isNaN(score2_home)) {
    alert('Veuillez saisir les scores (0 est un score valide)');
    return;
  }

  if (isHomeAway && (score1_away === null || score2_away === null || isNaN(score1_away) || isNaN(score2_away))) {
    alert('Veuillez saisir les scores aller ET retour (0 est un score valide)');
    return;
  }

  // D√©terminer automatiquement le gagnant
  let winner_id = null;

  if (isHomeAway) {
    const totalP1 = score1_home + score1_away;
    const totalP2 = score2_home + score2_away;

    if (totalP1 > totalP2) {
      winner_id = p1Id;
    } else if (totalP2 > totalP1) {
      winner_id = p2Id;
    } else {
      alert('‚ö†Ô∏è Match nul ! Le syst√®me ne g√®re pas encore les prolongations. Veuillez rejouer le match.');
      return;
    }
  } else {
    if (score1_home > score2_home) {
      winner_id = p1Id;
    } else if (score2_home > score1_home) {
      winner_id = p2Id;
    } else {
      alert('‚ö†Ô∏è Match nul ! Le syst√®me ne g√®re pas encore les prolongations. Veuillez rejouer le match.');
      return;
    }
  }

  try {
    await apiCall(`/tournaments/${tournamentId}/matches/${matchId}`, {
      method: 'PUT',
      body: JSON.stringify({ score1_home, score2_home, score1_away, score2_away, winner_id })
    });

    alert('‚úÖ R√©sultat enregistr√© !');
    viewTournament(tournamentId);
  } catch (err) {
    alert('‚ùå Erreur: ' + err.message);
  }
}

// Actions tournoi
async function startTournament(tournamentId) {
  if (!confirm('D√©marrer le tournoi ? Il passera en mode actif.')) return;

  try {
    await apiCall(`/tournaments/${tournamentId}`, {
      method: 'PUT',
      body: JSON.stringify({ status: 'active' })
    });

    alert('‚úÖ Tournoi d√©marr√© !');
    viewTournament(tournamentId);
  } catch (err) {
    alert('‚ùå Erreur: ' + err.message);
  }
}

async function closeTournament(tournamentId) {
  if (!confirm('Cl√¥turer le tournoi ? Il ne pourra plus √™tre modifi√©.')) return;

  try {
    await apiCall(`/tournaments/${tournamentId}`, {
      method: 'PUT',
      body: JSON.stringify({ status: 'closed' })
    });

    alert('‚úÖ Tournoi cl√¥tur√© !');
    viewTournament(tournamentId);
  } catch (err) {
    alert('‚ùå Erreur: ' + err.message);
  }
}

async function deleteTournament(tournamentId) {
  if (!confirm('‚ö†Ô∏è ATTENTION: Supprimer d√©finitivement ce tournoi ? Cette action est irr√©versible !')) return;

  try {
    await apiCall(`/tournaments/${tournamentId}`, {
      method: 'DELETE'
    });

    alert('‚úÖ Tournoi supprim√©');
    backToList();
  } catch (err) {
    alert('‚ùå Erreur: ' + err.message);
  }
}

// Initialisation
loadTournaments();
</script>

<footer style="text-align:center;padding:20px;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif">
  Copyright ¬© GOUZEPE GAMING CLUB 2025
</footer>
</body>
</html>
